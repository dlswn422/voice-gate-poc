from enum import Enum
from pydantic import BaseModel


class Intent(str, Enum):
    """
    주차장 키오스크 CX 기준 1차 발화 의도 분류 Enum

    [설계 원칙]
    - 즉시 제어 명령(문 열어/닫아)은 포함하지 않는다
    - 사용자의 발화를 '명령'이 아닌 '상황 설명 / 문제 / 문의'로 분류한다
    - 1차 모델은 실행 판단을 하지 않고, 의도 분류까지만 담당한다
    - 애매한 발화는 confidence를 낮게 주고 2차 모델로 위임한다
    """


    # ==================================================
    # 입·출차 흐름 중 문제 상황
    # ==================================================

    ENTRY_FLOW_ISSUE = "ENTRY_FLOW_ISSUE"
    """
    입차하려는 상황에서 차단기가 열리지 않거나
    정상적인 입차 흐름이 진행되지 않는 문제 상황

    [대표 발화 예시]
    - "들어가야 되는데 안 열려요"
    - "입차가 안 돼요"
    - "차가 못 들어가요"

    ⚠️ 주의
    - 출차 문제(EXIT_FLOW_ISSUE)와 구분 필요
    """


    EXIT_FLOW_ISSUE = "EXIT_FLOW_ISSUE"
    """
    출차하려는 상황에서 차단기가 열리지 않거나
    정상적인 출차 흐름이 진행되지 않는 문제 상황

    [대표 발화 예시]
    - "나가야 되는데 안 열려요"
    - "출차가 안 돼요"
    - "차가 나가질 않아요"

    ⚠️ 주의
    - '열어주세요' 같은 표현도 명령이 아닌 상황 설명으로 본다
    """


    # ==================================================
    # 결제 / 등록 관련 문제
    # ==================================================

    PAYMENT_ISSUE = "PAYMENT_ISSUE"
    """
    주차 요금 결제와 관련된 문제 상황

    [대표 발화 예시]
    - "카드 결제했는데 안 돼요"
    - "결제 오류났어요"
    - "돈 냈는데 출차가 안 돼요"
    """


    REGISTRATION_ISSUE = "REGISTRATION_ISSUE"
    """
    차량 / 방문자 / 번호판 등록과 관련된 문제 상황

    [대표 발화 예시]
    - "방문 등록했는데 안 돼요"
    - "차량 등록이 안 돼요"
    - "번호판 인식이 안 돼요"
    """


    # ==================================================
    # 시간 / 요금 관련 문의
    # ==================================================

    TIME_ISSUE = "TIME_ISSUE"
    """
    주차 시간, 무료 시간, 초과 시간 등
    '시간'과 관련된 문의 또는 문제 인식

    [대표 발화 예시]
    - "시간이 초과됐어요"
    - "무료 시간 끝났나요?"
    - "시간 좀 늘려주세요"

    ⚠️ 주의
    - 실제 연장 가능 여부 판단은 2차 로직 또는 정책 영역
    """


    PRICE_INQUIRY = "PRICE_INQUIRY"
    """
    주차 요금 또는 정산 금액에 대한 단순 문의

    [대표 발화 예시]
    - "주차비 얼마예요?"
    - "요금 얼마나 나와요?"
    - "얼마 결제해야 돼요?"

    ⚠️ 주의
    - 결제 오류는 PAYMENT_ISSUE로 분리
    """


    # ==================================================
    # 사용 방법 문의
    # ==================================================

    HOW_TO_EXIT = "HOW_TO_EXIT"
    """
    출차 방법에 대한 문의

    [대표 발화 예시]
    - "어떻게 나가요?"
    - "뭐 눌러야 출차돼요?"
    """


    HOW_TO_REGISTER = "HOW_TO_REGISTER"
    """
    방문자 / 차량 등록 방법에 대한 문의

    [대표 발화 예시]
    - "방문 등록 어떻게 해요?"
    - "차량 등록은 어디서 해요?"
    """


    # ==================================================
    # 감정 / 상태 표현
    # ==================================================

    COMPLAINT = "COMPLAINT"
    """
    불만, 짜증, 혼란 등의 감정 또는 상태 표현
    (원인이 명확하지 않은 경우)

    [대표 발화 예시]
    - "아 왜 이래"
    - "이거 뭐야"
    - "계속 안 되네"

    ⚠️ 주의
    - 즉시 해결이나 제어로 연결하지 않는다
    - 2차 모델로 넘기기 가장 좋은 유형
    """


    # ==================================================
    # 무관
    # ==================================================

    NONE = "NONE"
    """
    주차장 이용과 무관한 발화
    """


class IntentResult(BaseModel):
    """
    1차 의도 분류 결과 스키마

    intent:
        - 분류된 발화 의도 (Intent Enum)

    confidence:
        - 해당 발화를 이 intent로 분류해도 될 정도의 명확성
        - 0.0 ~ 1.0 범위
        - 낮을수록 애매하며, 2차 모델로 위임하기 적합
    """
    intent: Intent
    confidence: float
