from enum import Enum
from pydantic import BaseModel


class Intent(str, Enum):
    """
    주차장 키오스크 CX 기준 '1차 발화 의도 분류' Enum

    [핵심 설계 철학]
    - 1차 모델은 '무슨 주제인지'만 분류한다 (WHY / HOW 판단 ❌)
    - 실행, 제어, 해결 판단은 절대 하지 않는다
    - 한 문장 응답으로 끝낼 수 있는지,
      추가 대화가 필요한지는 Decision Layer에서 판단한다
    - HOW_TO / ISSUE / ERROR 같은 세부 원인은 여기서 다루지 않는다

    즉,
    👉 이 Enum은 '대화 라우팅용 라벨'이다
    """


    # ==================================================
    # 입차 관련 발화 (주제: 입차)
    # ==================================================
    ENTRY = "ENTRY"
    """
    입차와 관련된 모든 발화

    [포함 예시]
    - "들어가야 되는데 안 열려요"
    - "입차가 안 돼요"
    - "차가 못 들어가요"
    - "입차는 어떻게 하나요?"

    [중요]
    - '방법 문의'와 '문제 상황'을 구분하지 않는다
    - 실제 대응(안내/질문/조치)은 Decision Layer 또는 2차 모델에서 결정
    """


    # ==================================================
    # 출차 관련 발화 (주제: 출차)
    # ==================================================
    EXIT = "EXIT"
    """
    출차와 관련된 모든 발화

    [포함 예시]
    - "나가야 되는데 안 열려요"
    - "출차가 안 돼요"
    - "여기서 어떻게 나가요?"
    - "차단기가 안 열려요"

    [중요]
    - HOW_TO_EXIT, EXIT_FLOW_ISSUE 같은 세분화는 하지 않는다
    - 이 단계에서는 '출차 이야기다'까지만 알면 충분
    """


    # ==================================================
    # 결제 / 요금 / 정산 관련 발화
    # ==================================================
    PAYMENT = "PAYMENT"
    """
    주차 요금, 결제, 정산과 관련된 모든 발화

    [포함 예시]
    - "주차비 얼마예요?"
    - "결제가 안 돼요"
    - "돈 냈는데 출차가 안 돼요"
    - "카드 결제했는데 오류나요"

    [중요]
    - 요금 문의 vs 결제 오류를 여기서 나누지 않는다
    - '정보 제공으로 끝나는지' 여부는 Decision Layer에서 판단
    """


    # ==================================================
    # 방문자 / 차량 / 번호판 등록 관련 발화
    # ==================================================
    REGISTRATION = "REGISTRATION"
    """
    차량 등록, 방문자 등록, 번호판 인식과 관련된 발화

    [포함 예시]
    - "방문 등록 어떻게 해요?"
    - "차량 등록이 안 돼요"
    - "번호판 인식이 안 돼요"

    [중요]
    - 등록 '방법'과 '문제'를 분리하지 않는다
    """


    # ==================================================
    # 시간 / 요금 정책 관련 단순 문의
    # ==================================================
    TIME_PRICE = "TIME_PRICE"
    """
    주차 시간, 무료 시간, 요금 정책에 대한 문의

    [포함 예시]
    - "무료 시간 끝났나요?"
    - "지금 몇 시간째에요?"
    - "시간 초과되면 얼마 나와요?"

    [중요]
    - 실제 연장 가능 여부, 할인 여부 판단은 정책/2차 영역
    """


    # ==================================================
    # 시설 / 기기 이상 관련 발화
    # ==================================================
    FACILITY = "FACILITY"
    """
    차단기, 키오스크, 인식기 등 물리적 설비 이상에 대한 발화

    [포함 예시]
    - "기계가 멈췄어요"
    - "화면이 안 켜져요"
    - "차단기가 이상해요"

    [중요]
    - EXIT / ENTRY와 겹칠 수 있음
    - 겹칠 경우 '주제 중심'으로 가장 가까운 것으로 분류
    """


    # ==================================================
    # 불만 / 감정 / 혼란 표현
    # ==================================================
    COMPLAINT = "COMPLAINT"
    """
    불만, 짜증, 당황, 혼란 등의 감정 표현

    [포함 예시]
    - "아 왜 이래요"
    - "이거 뭐에요?"
    - "계속 안 되네 진짜"

    [중요]
    - 원인이 명확하지 않은 경우가 대부분
    - 2차 모델로 넘기기에 가장 적합한 유형
    """


    # ==================================================
    # 주차장과 무관한 발화
    # ==================================================
    NONE = "NONE"
    """
    주차장 이용과 직접적인 관련이 없는 발화
    """


class IntentResult(BaseModel):
    """
    1차 의도 분류 결과 스키마

    intent:
        - 발화의 '주제(Level-1 Intent)'

    confidence:
        - 이 발화를 해당 intent로 분류해도 될 명확성
        - 0.0 ~ 1.0 범위
        - 낮을수록 애매하며,
          Decision Layer에서 2차 모델로 위임하기 적합
    """

    intent: Intent
    confidence: float